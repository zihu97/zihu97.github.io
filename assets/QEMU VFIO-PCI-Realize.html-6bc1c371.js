const e=JSON.parse('{"key":"v-8b532978","path":"/posts/linux/virtualization/qemu/VFIO-PCI-Realize/QEMU%20VFIO-PCI-Realize.html","title":"VFIO框架源码分析（九）- VFIO-PCI 设备实例化 (Realize) 流程全解","lang":"zh-CN","frontmatter":{"date":"2025-11-26T00:00:00.000Z","article":true,"category":["tech"],"tag":["vfio","qemu"],"description":"VFIO框架源码分析（九）- VFIO-PCI 设备实例化 (Realize) 流程全解 简介与背景 当用户在启动参数中写下 -device vfio-pci,host=0000:01:00.0 时，QEMU 内部发生了一场复杂的“接力跑”。 vfio_realize 函数是将虚拟设备对象与物理硬件真正绑定的核心枢纽。 它不仅要打开设备文件，还要解析硬件资源（BAR、中断），并将其映射到虚拟机的地址空间中。 如果这一步失败，虚拟机将无法启动或无法看到该设备。 逐层代码拆解 vfio_realize位于 hw/vfio/pci.c，是 PCIDeviceClass 的 realize 方法实现。它的主要职责是：资源发现、资源映射、错误处理。","head":[["meta",{"property":"og:url","content":"https://zihu97.github.io/posts/linux/virtualization/qemu/VFIO-PCI-Realize/QEMU%20VFIO-PCI-Realize.html"}],["meta",{"property":"og:site_name","content":"紫狐"}],["meta",{"property":"og:title","content":"VFIO框架源码分析（九）- VFIO-PCI 设备实例化 (Realize) 流程全解"}],["meta",{"property":"og:description","content":"VFIO框架源码分析（九）- VFIO-PCI 设备实例化 (Realize) 流程全解 简介与背景 当用户在启动参数中写下 -device vfio-pci,host=0000:01:00.0 时，QEMU 内部发生了一场复杂的“接力跑”。 vfio_realize 函数是将虚拟设备对象与物理硬件真正绑定的核心枢纽。 它不仅要打开设备文件，还要解析硬件资源（BAR、中断），并将其映射到虚拟机的地址空间中。 如果这一步失败，虚拟机将无法启动或无法看到该设备。 逐层代码拆解 vfio_realize位于 hw/vfio/pci.c，是 PCIDeviceClass 的 realize 方法实现。它的主要职责是：资源发现、资源映射、错误处理。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://zihu97.github.io/"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-23T05:36:29.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:alt","content":"VFIO框架源码分析（九）- VFIO-PCI 设备实例化 (Realize) 流程全解"}],["meta",{"property":"article:author","content":"紫狐"}],["meta",{"property":"article:tag","content":"vfio"}],["meta",{"property":"article:tag","content":"qemu"}],["meta",{"property":"article:published_time","content":"2025-11-26T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-23T05:36:29.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"VFIO框架源码分析（九）- VFIO-PCI 设备实例化 (Realize) 流程全解\\",\\"image\\":[\\"https://zihu97.github.io/\\"],\\"datePublished\\":\\"2025-11-26T00:00:00.000Z\\",\\"dateModified\\":\\"2025-11-23T05:36:29.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"紫狐\\",\\"url\\":\\"https://zihu97.github.io/\\"}]}"]]},"headers":[{"level":2,"title":"简介与背景","slug":"简介与背景","link":"#简介与背景","children":[]},{"level":2,"title":"逐层代码拆解","slug":"逐层代码拆解","link":"#逐层代码拆解","children":[{"level":3,"title":"建立连接：vfio_attach_device","slug":"建立连接-vfio-attach-device","link":"#建立连接-vfio-attach-device","children":[]},{"level":3,"title":"摸清家底：vfio_populate_device","slug":"摸清家底-vfio-populate-device","link":"#摸清家底-vfio-populate-device","children":[]},{"level":3,"title":"虚拟化映射：vfio_bars_register","slug":"虚拟化映射-vfio-bars-register","link":"#虚拟化映射-vfio-bars-register","children":[]},{"level":3,"title":"关联 IOMMU：pci_device_set_iommu_device","slug":"关联-iommu-pci-device-set-iommu-device","link":"#关联-iommu-pci-device-set-iommu-device","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]},{"level":2,"title":"关于作者","slug":"关于作者","link":"#关于作者","children":[]}],"git":{"createdTime":1763876189000,"updatedTime":1763876189000,"contributors":[{"name":"zihu97","email":"zihu@chipltech.com","commits":1}]},"readingTime":{"minutes":3.24,"words":972},"filePathRelative":"posts/linux/virtualization/qemu/VFIO-PCI-Realize/QEMU VFIO-PCI-Realize.md","localizedDate":"2025年11月26日","excerpt":"<h1> VFIO框架源码分析（九）- VFIO-PCI 设备实例化 (Realize) 流程全解</h1>\\n<h2> 简介与背景</h2>\\n<p>当用户在启动参数中写下 -device vfio-pci,host=0000:01:00.0 时，QEMU 内部发生了一场复杂的“接力跑”。</p>\\n<p>vfio_realize 函数是将虚拟设备对象与物理硬件真正绑定的核心枢纽。</p>\\n<p>它不仅要打开设备文件，还要解析硬件资源（BAR、中断），并将其映射到虚拟机的地址空间中。\\n如果这一步失败，虚拟机将无法启动或无法看到该设备。</p>\\n<h2> 逐层代码拆解</h2>\\n<p>vfio_realize位于 hw/vfio/pci.c，是 PCIDeviceClass 的 realize 方法实现。它的主要职责是：资源发现、资源映射、错误处理。</p>","autoDesc":true}');export{e as data};
