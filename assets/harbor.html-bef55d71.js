import{_ as r,W as t,X as o,Z as e,$ as a,a0 as s,a2 as i,C as l}from"./framework-3a0c4e99.js";const d={},c=e("h1",{id:"build-with-harbor",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#build-with-harbor","aria-hidden":"true"},"#"),a(" build with harbor")],-1),u=e("h1",{id:"_1-private-docker-registry-selection",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_1-private-docker-registry-selection","aria-hidden":"true"},"#"),a(" 1 Private Docker Registry Selection")],-1),p={href:"https://supereagle.github.io/2019/11/23/harbor-vs-quay/",target:"_blank",rel:"noopener noreferrer"},h={id:"_2-harbor-installation-and-configuration",tabindex:"-1"},v=e("a",{class:"header-anchor",href:"#_2-harbor-installation-and-configuration","aria-hidden":"true"},"#",-1),b={href:"https://goharbor.io/docs/2.11.0/install-config/",target:"_blank",rel:"noopener noreferrer"},m=e("p",null,"本章全程参考官网给出的手册",-1),k={id:"_2-1-prerequisites",tabindex:"-1"},g=e("a",{class:"header-anchor",href:"#_2-1-prerequisites","aria-hidden":"true"},"#",-1),_={href:"https://goharbor.io/docs/2.11.0/install-config/installation-prereqs/",target:"_blank",rel:"noopener noreferrer"},f=e("thead",null,[e("tr",null,[e("th",null,[e("strong",null,"Software")]),e("th",null,[e("strong",null,"Version")]),e("th",null,[e("strong",null,"Description")])])],-1),x=e("td",null,"Docker Engine",-1),y=e("td",null,"Version 20.10.10-ce+ or higher",-1),q={href:"https://docs.docker.com/engine/installation/",target:"_blank",rel:"noopener noreferrer"},w=e("td",null,"Docker Compose",-1),E=e("td",null,"docker-compose (v1.18.0+) or docker compose v2 (docker-compose-plugin)",-1),C={href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"},D=e("tr",null,[e("td",null,"OpenSSL"),e("td",null,"Latest is preferred"),e("td",null,"Used to generate certificate and keys for Harbor")],-1),M=e("p",null,"docker engine和docker compose可以通过docker desktop安装，以下适用于ubuntu 22.04",-1),S={id:"_2-1-1-install-docker-desktop-on-ubuntu",tabindex:"-1"},z=e("a",{class:"header-anchor",href:"#_2-1-1-install-docker-desktop-on-ubuntu","aria-hidden":"true"},"#",-1),H={href:"https://docs.docker.com/desktop/install/ubuntu/",target:"_blank",rel:"noopener noreferrer"},L=e("strong",null,"install docker desktop on ubuntu",-1),I={id:"_2-1-1-1-install-using-the-apt-repository",tabindex:"-1"},V=e("a",{class:"header-anchor",href:"#_2-1-1-1-install-using-the-apt-repository","aria-hidden":"true"},"#",-1),j={href:"https://docs.docker.com/engine/install/ubuntu/",target:"_blank",rel:"noopener noreferrer"},A=e("strong",null,"install using the apt repository",-1),G={href:"https://zhuanlan.zhihu.com/p/588264423",target:"_blank",rel:"noopener noreferrer"},N=i(`<h5 id="_2-1-1-1-1-安装设置仓库必须的工具" tabindex="-1"><a class="header-anchor" href="#_2-1-1-1-1-安装设置仓库必须的工具" aria-hidden="true">#</a> 2.1.1.1.1 安装设置仓库必须的工具</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> ca-certificates <span class="token function">curl</span> gnupg lsb-release
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2-1-1-1-2-添加阿里的-docker-镜像仓库证书" tabindex="-1"><a class="header-anchor" href="#_2-1-1-1-2-添加阿里的-docker-镜像仓库证书" aria-hidden="true">#</a> 2.1.1.1.2 添加阿里的 Docker 镜像仓库证书</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span> /etc/apt/keyrings/aliyun-docker.gpg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2-1-1-1-3-添加仓库" tabindex="-1"><a class="header-anchor" href="#_2-1-1-1-3-添加仓库" aria-hidden="true">#</a> 2.1.1.1.3 添加仓库</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token punctuation">\\</span>
  <span class="token string">&quot;deb [arch=<span class="token variable"><span class="token variable">$(</span>dpkg --print-architecture<span class="token variable">)</span></span> signed-by=/etc/apt/keyrings/aliyun-docker.gpg] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \\
  <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">&gt;</span> /dev/null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),R={id:"_2-1-1-2-download-latest-deb-package",tabindex:"-1"},T=e("a",{class:"header-anchor",href:"#_2-1-1-2-download-latest-deb-package","aria-hidden":"true"},"#",-1),B={href:"https://desktop.docker.com/linux/main/amd64/docker-desktop-amd64.deb?utm_source=docker&utm_medium=webreferral&utm_campaign=docs-driven-download-linux-amd64&_gl=1*1bzne95*_ga*Mzk5NTI4MjQ1LjE3MjE3MDU4MTE.*_ga_XJWPQMJYHQ*MTcyMzYxNjg4Ni4zLjEuMTcyMzYxNzk4MC42MC4wLjA.",target:"_blank",rel:"noopener noreferrer"},P=i(`<h4 id="_2-1-1-3-install-the-package-with-apt-as-follows" tabindex="-1"><a class="header-anchor" href="#_2-1-1-3-install-the-package-with-apt-as-follows" aria-hidden="true">#</a> 2.1.1.3 Install the package with apt as follows</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ./docker-desktop-<span class="token operator">&lt;</span>arch<span class="token operator">&gt;</span>.deb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-1-2-launch-docker-desktop" tabindex="-1"><a class="header-anchor" href="#_2-1-2-launch-docker-desktop" aria-hidden="true">#</a> 2.1.2 launch docker desktop</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl <span class="token parameter variable">--user</span> start docker-desktop

systemctl <span class="token parameter variable">--user</span> <span class="token builtin class-name">enable</span> docker-desktop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-1-3-check-the-versions" tabindex="-1"><a class="header-anchor" href="#_2-1-3-check-the-versions" aria-hidden="true">#</a> 2.1.3 check the versions</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> compose version

<span class="token function">docker</span> <span class="token parameter variable">--version</span>

<span class="token function">docker</span> version
Client: Docker Engine - Community
 Version:           <span class="token number">27.1</span>.2
 API version:       <span class="token number">1.46</span>
 Go version:        go1.21.13
 Git commit:        d01f264
 Built:             Mon Aug <span class="token number">12</span> <span class="token number">11</span>:50:12 <span class="token number">2024</span>
 OS/Arch:           linux/amd64
 Context:           default

Server: Docker Engine - Community
 Engine:
  Version:          <span class="token number">27.1</span>.2
  API version:      <span class="token number">1.46</span> <span class="token punctuation">(</span>minimum version <span class="token number">1.24</span><span class="token punctuation">)</span>
  Go version:       go1.21.13
  Git commit:       f9522e5
  Built:            Mon Aug <span class="token number">12</span> <span class="token number">11</span>:50:12 <span class="token number">2024</span>
  OS/Arch:          linux/amd64
  Experimental:     <span class="token boolean">false</span>
 containerd:
  Version:          <span class="token number">1.7</span>.20
  GitCommit:        8fc6bcff51318944179630522a095cc9dbf9f353
 runc:
  Version:          <span class="token number">1.1</span>.13
  GitCommit:        v1.1.13-0-g58aa920
 docker-init:
  Version:          <span class="token number">0.19</span>.0
  GitCommit:        de40ad0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),F={id:"_2-2-download-the-harbor-installer",tabindex:"-1"},O=e("a",{class:"header-anchor",href:"#_2-2-download-the-harbor-installer","aria-hidden":"true"},"#",-1),Y={href:"https://goharbor.io/docs/2.11.0/install-config/download-installer/",target:"_blank",rel:"noopener noreferrer"},U=i(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>https://github.com/goharbor/harbor/releases

<span class="token function">tar</span> xzvf harbor-offline-installer-version.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Q={id:"_2-3-configure-the-harbor-yml-file",tabindex:"-1"},W=e("a",{class:"header-anchor",href:"#_2-3-configure-the-harbor-yml-file","aria-hidden":"true"},"#",-1),$={href:"https://goharbor.io/docs/2.11.0/install-config/configure-yml-file/",target:"_blank",rel:"noopener noreferrer"},J=i(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> harbor
<span class="token function">cp</span> harbor.yml.tmpl harbor.yml
<span class="token comment"># 修改hostname为本机ip，如192.168.2.248</span>
<span class="token comment"># 修改http port为想要开放的端口，如30080</span>
<span class="token comment"># 注释https相关字段，暂时不考虑安全认证</span>
<span class="token comment"># 可以留意到harbor_admin_password默认为Harbor12345</span>
<span class="token function">vi</span> harbor.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),X={id:"_2-4-run-the-installer-script",tabindex:"-1"},K=e("a",{class:"header-anchor",href:"#_2-4-run-the-installer-script","aria-hidden":"true"},"#",-1),Z={href:"https://goharbor.io/docs/2.11.0/install-config/run-installer-script/",target:"_blank",rel:"noopener noreferrer"},ee=i(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./install.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-4-1-connecting-to-harbor-via-http" tabindex="-1"><a class="header-anchor" href="#_2-4-1-connecting-to-harbor-via-http" aria-hidden="true">#</a> 2.4.1 Connecting to Harbor via HTTP</h3><h4 id="_2-4-1-1-restart-docker-engine" tabindex="-1"><a class="header-anchor" href="#_2-4-1-1-restart-docker-engine" aria-hidden="true">#</a> 2.4.1.1 Restart Docker Engine</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl daemon-reload
systemctl restart <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-1-2-stop-harbor" tabindex="-1"><a class="header-anchor" href="#_2-4-1-2-stop-harbor" aria-hidden="true">#</a> 2.4.1.2 Stop Harbor</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> compose down <span class="token parameter variable">-v</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-4-1-1-restart-harbor" tabindex="-1"><a class="header-anchor" href="#_2-4-1-1-restart-harbor" aria-hidden="true">#</a> 2.4.1.1 Restart Harbor</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="_3-startup-service" tabindex="-1"><a class="header-anchor" href="#_3-startup-service" aria-hidden="true">#</a> 3 Startup service</h1><h2 id="_3-1-configure-service" tabindex="-1"><a class="header-anchor" href="#_3-1-configure-service" aria-hidden="true">#</a> 3.1 configure service</h2><p>vi /etc/systemd/system/harbor.service</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Start Harbor after Docker
<span class="token assign-left variable">After</span><span class="token operator">=</span>docker.service
<span class="token assign-left variable">Requires</span><span class="token operator">=</span>docker.service

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/home/cltech/zihu/harbor/install.sh
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-2-start-service" tabindex="-1"><a class="header-anchor" href="#_3-2-start-service" aria-hidden="true">#</a> 3.2 start service</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> harbor.service
<span class="token function">sudo</span> systemctl start harbor.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-3-query-service" tabindex="-1"><a class="header-anchor" href="#_3-3-query-service" aria-hidden="true">#</a> 3.3 query service</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl status harbor.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="_4-private-docker-registry" tabindex="-1"><a class="header-anchor" href="#_4-private-docker-registry" aria-hidden="true">#</a> 4 private docker registry</h1><h1 id="_4-1-registry-url" tabindex="-1"><a class="header-anchor" href="#_4-1-registry-url" aria-hidden="true">#</a> 4.1 registry URL</h1><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>http://192.168.2.248:30080
admin
Harbor12345
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-2-configure-docker" tabindex="-1"><a class="header-anchor" href="#_4-2-configure-docker" aria-hidden="true">#</a> 4.2 configure docker</h1><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">&#39;EOF&#39;
{
    &quot;registry-mirrors&quot;: [
        &quot;https://docker.m.daocloud.io&quot;
        &quot;https://docker.mirrors.ustc.edu.cn&quot;,
        &quot;https://hub-mirror.c.163.com&quot;,
        &quot;https://mirror.baidubce.com&quot;,
        &quot;https://ccr.ccs.tencentyun.com&quot;
    ],
    &quot;insecure-registries&quot;: [&quot;192.168.2.248:30080&quot;]
}
EOF</span>

<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-3-push-images" tabindex="-1"><a class="header-anchor" href="#_4-3-push-images" aria-hidden="true">#</a> 4.3 push images</h1><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> images
<span class="token function">docker</span> tag d2c94e258dcb <span class="token number">192.168</span>.2.248:30080/driver/hello-world:1.0
<span class="token function">docker</span> login <span class="token parameter variable">-u</span> admin <span class="token parameter variable">-p</span> Harbor12345 <span class="token number">192.168</span>.2.248:30080
<span class="token function">docker</span> push <span class="token number">192.168</span>.2.248:30080/driver/hello-world:1.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyRpYGvLeqLbj/img/a28f0074-9734-4fdf-a85e-096d771bae73.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h1 id="_4-4-pull-images" tabindex="-1"><a class="header-anchor" href="#_4-4-pull-images" aria-hidden="true">#</a> 4.4 pull images</h1><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull <span class="token number">192.168</span>.2.248:30080/driver/hello-world:1.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="_5-过程踩到的坑" tabindex="-1"><a class="header-anchor" href="#_5-过程踩到的坑" aria-hidden="true">#</a> 5 过程踩到的坑</h1><h2 id="_5-1-docker-daemon没有拉起来" tabindex="-1"><a class="header-anchor" href="#_5-1-docker-daemon没有拉起来" aria-hidden="true">#</a> 5.1 docker daemon没有拉起来？</h2><p>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl status docker.service
journalctl <span class="token parameter variable">-xeu</span> docker.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>出问题了请先查docker logs</strong></p><p>这次遇到的问题是和iptables相关，解决办法是</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>update-alternatives <span class="token parameter variable">--set</span> iptables /usr/sbin/iptables-legacy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,33);function ae(ne,se){const n=l("ExternalLinkIcon");return t(),o("div",null,[c,u,e("p",null,[e("a",p,[a("https://supereagle.github.io/2019/11/23/harbor-vs-quay/"),s(n)])]),e("h1",h,[v,a(" 2 "),e("a",b,[a("Harbor Installation and Configuration"),s(n)])]),m,e("h2",k,[g,a(" 2.1 "),e("a",_,[a("Prerequisites"),s(n)])]),e("table",null,[f,e("tbody",null,[e("tr",null,[x,y,e("td",null,[a("For installation instructions, see "),e("a",q,[a("Docker Engine documentation"),s(n)])])]),e("tr",null,[w,E,e("td",null,[a("For installation instructions, see "),e("a",C,[a("Docker Compose documentation"),s(n)])])]),D])]),M,e("h3",S,[z,a(" 2.1.1 "),e("a",H,[L,s(n)])]),e("h4",I,[V,a(" 2.1.1.1 "),e("a",j,[A,s(n)])]),e("p",null,[a("官网提供的源对国内用户不友好，以下使用"),e("a",G,[a("阿里的docker镜像仓库证书"),s(n)])]),N,e("h4",R,[T,a(" 2.1.1.2 Download latest "),e("a",B,[a("DEB package"),s(n)])]),P,e("h2",F,[O,a(" 2.2 "),e("a",Y,[a("Download the Harbor Installer"),s(n)])]),U,e("h2",Q,[W,a(" 2.3 "),e("a",$,[a("Configure the Harbor YML File"),s(n)])]),J,e("h2",X,[K,a(" 2.4 "),e("a",Z,[a("Run the Installer Script"),s(n)])]),ee])}const re=r(d,[["render",ae],["__file","harbor.html.vue"]]);export{re as default};
